# 1.OSI与TCP/IP

网络的7层架构（从上至下）：

1. 应用层：终端应用
2. 表示层：对数据进行解密加密、压缩与解压缩等
3. 会话层：不同机器通过传输层建立传输的通道
4. 传输层：采用TCP/UDP等协议对下层接收到的数据进行分段传输，这层数据叫做段
5. 网络层：将ip地址进行封装与解封装，这层数据叫做数据包
6. 数据链路层：将mac地址进行封装与解封装，这层数据叫做帧
7. 物理层：将0和1等转化为电流的强弱，这层数据叫做比特

TCP/IP协议族：

从协议分层模型来讲，由四个层次组成（从上至下）：

1. 应用层：应用层包含所有的高层协议，比如FTP（文件传输协议）、HTTP（超文本传输协议）、SMTP（电子邮件传输协议）、DNS（域名服务）等
2. 传输层：在两个机器之间进行传输，提供两种协议，TCP（传输控制协议）、UDP（用户数据报协议）
3. 网络层：采用IP协议，使主机可以把分组发往任何网络，并使分组独立的发往目标
4. 网络接口层：主机必须使用某种协议与网络相连

综合上面两种优点，采取五层协议的结构（从上至下）：

1. 应用层：定义应用进程间的通信和交互的规则，数据单元称为报文
2. 传输层：负责向两台主机进程之间提供数据传输服务
3. 网络层：采用IP协议，选择合适的网间路由和交换结点
4. 数据链路层：将网络层交下来的数据组装成帧
5. 物理层：实现相邻结点间比特流的透明传送

# 2.TCP三次握手和四次挥手

## 2.1数据包的说明

1. 16位源端口号：2个字节

2. 16位目的端口号：这两个值加上IP报头中的源主机IP地址和目的主机IP地址唯一确定一个TCP连接

3. 32位序号seq：TCP连接中传送的字节流中的每个字节都按顺序编号，比如一段报文的序号字段值是101，携带的数据有100个字段，下一个报文段的序号就从201开始

4. 32位确认号ack：期望收到对方下一个报文的序号，比如B收到A发来的序号201开始的报文，长度为200，因此B期望收到A的下一个数据序号就是401，就把确认号置位701

5. 4位TCP报头长度：指明数据从哪里开始

6. 6位保留位：保留给将来使用，目前必须置为0

7. 6位控制位，分别为：
   URG：为1表明紧急指针字段有效，告诉系统此报文段中有紧急数据

   ACK：为1表示确认号字段有效，在连接建立后所有报文的传输都必须把ACK置为1

   PSH：为1表示是带有PUSH标志的数据，告诉接收方必须尽快把这个报文段交给应用层而不用等待缓冲区装满

   RST：当RST=1，表明TCP连接中出现严重差错，必须释放连接，重新建立连接

   SYN：同步序号，为1表示连接请求，SYN=1，ACK=0表明是连接请求报文，如果同意连接，响应报文中应该使SYN=1，ACK=1

   FIN：用于释放连接，为1表示发送方已经没有数据发送了，要求释放连接

8. 16位窗口大小：通知接收方需要有多大的空间来接收该报文

9. 16位检验和：检验首部和数据两部分，发送端计算和存储，接收端进行验证

10. 16位紧急指针：URG为1时有效

11. 选项：定义一些其他的可选的参数

    ![image-20200426224951110](C:\Users\11579\AppData\Roaming\Typora\typora-user-images\image-20200426224951110.png)

## 2.2三次握手

第一次握手：主机A发送SYN=1，选择一个初始序列号seq=x ，主机B根据SYN=1知道，A请求建立连接

第二次握手：主机B收到请求后如果同意连接向A发送确认报文，确认报文中ACK=1，SYN=1，确认号是ack=x+1，同时自己初始化一个序列号seq=y

第三次握手：主机A收到确认后，还要向主机B给出确认，确认报文的ACK=1，seq=x+1，ack=y+1，主机B收到后确认则连接建立成功























